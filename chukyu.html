<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=1280">
    <title>もぐらたたき</title>
    <link rel="icon" href="images/mogu.ico">
    <link rel="stylesheet" href="css/common.css">


</head>

<body>

    <div class="field">
        <div id="game">
            <div class="container">
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
            </div>
            <div class="container">
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
            </div>
            <div class="container">
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
                <div class="relative">
                    <img class="ana" src="images/mogu1.png">
                </div>
            </div>
        </div>
        <nav id="nav">
            <div id="title">
                <a href="index.html">
                    <div id="logo">
                        <img src="images/title.png" alt="もぐら叩き">
                    </div>
                </a>
                <br>
                <div><img src="images/start.png" alt="スタート" id="game_startend"></div>
                <div><img src="images/again.png" alt="もう一度" id="again"></div>

            </div>

            <div id="score_timer">
                <div class="score">
                    <label>SCORE</label><a id="score"></a>
                </div><br>
                <div class="timer">
                    <label>COUNT</label><a id="timer">20</a>
                </div>
            </div>

        </nav>


    </div><!-- /.field -->

</body>
<script>
    'use strict';
    /** カウントダウンタイマーfunction
   * @ time -- 何秒からカウントダウンするか
   * 1秒ごとに0になるまで数字が減っていく
    */
    function timer(time) {
        let count = time;
        let id = setInterval(function () {
            count--;
            document.getElementById('timer').textContent = count;
            if (count <= 0) {
                clearInterval(id)
            };
        }, 1000);
    }

    // スコア表示の設定
    let score = 0;
    let scoreText = document.getElementById("score");
    scoreText.textContent = score;


    //モグラの雛型設計
    class Mogura {
        constructor(index) {
            this.index = index;
            //     this.img = this.normalImg;
            this.normalImg = "images/mogu2.png";
            this.abnormalImg = "images/mogu4.png";
            this.itaiImg = "images/mogu3.png";
            this.kakusuImg = "images/mogu1.png";
            this.hit = false; // 初期設定：叩けない状態
            this.visility = false; // もぐらの飛び出し状態
            this.abnormal = false; // 叩いたらスコアマイナスの画像表示されているかどうか
        }

    }

    // モグラオブジェクトを９個作った
    const moguras = [];

    for (let i = 0; i < 9; i++) {
        moguras.push(new Mogura(i));
    }

    // HTMLの９個の('.ana')のついたタグを選択
    // それぞれのsrcに kakusuImg を入れる
    const anaGroup = document.querySelectorAll('.ana');

    anaGroup.forEach(function (item, index) {
        item.src = moguras[index].kakusuImg;
    });


    // moguras[i].visility === true の時だけ、モグラを叩けるfunction
    // moguras[i].abnormal === true の時は、叩いたら-2点になる。

    // モグラが飛び出しているとこをクリックした時、「モグライタイ」画像に変え、
    // moguras[i].hit = true;
    // 飛び出したモグラは500ms後に隠れてる画像に戻し、
    // moguras[i].hit = false;に戻す。
    for (let i = 0; i < anaGroup.length; i++) {
        anaGroup[i].onclick = function () {
            if (moguras[i].visility === true) {
                anaGroup[i].src = moguras[i].itaiImg;
                moguras[i].hit = true;
                score++;
                scoreText.innerHTML = score;

                // 500ミリ秒後に消える
                setTimeout(function () {
                    anaGroup[i].src = moguras[i].kakusuImg;
                    moguras[i].hit = false;
                }, 500);
            } else if (moguras[i].abnormal === true) {
                anaGroup[i].src = moguras[i].itaiImg;
                moguras[i].hit = true;
                score = score - 2;
                scoreText.innerHTML = score;

                // 500ミリ秒後に消える
                setTimeout(function () {
                    anaGroup[i].src = moguras[i].kakusuImg;
                    moguras[i].hit = false;
                }, 500);

            }
        }
    }

    /**
        // ゲーム終了時のアクション
        // スタートをクリックしてから20秒後にゲーム終了「スタート」が「おわり」に変わる
        // 20秒後に総得点がアラートで表示される。
        */
    document.getElementById('game_startend').onclick = function () {

        // カウントダウンタイマーに切り替わる
        document.getElementById('timer').textContent = timer(20)

        // もぐらが1000msごとにひょこり、800msごとに隠れる
        // 飛び出している間は.visility = trueとなり、モグラが叩ける。
        // 800ms後にモグラが隠れて、.visility = falseとなり、モグラが叩けない。
        let moguraGenerator = setInterval(function () {
            let num = Math.floor(Math.random() * anaGroup.length);
            anaGroup[num].src = moguras[num].normalImg;
            moguras[num].visility = true;

            setTimeout(function () {
                anaGroup[num].src = moguras[num].kakusuImg;
                moguras[num].visility = false;
            }, 800);

        }, 1000);

        let moguraGenerator2 = setInterval(function () {
            let num2 = Math.floor(Math.random() * anaGroup.length);
            anaGroup[num2].src = moguras[num2].normalImg;
            moguras[num2].visility = true;

            setTimeout(function () {
                anaGroup[num2].src = moguras[num2].kakusuImg;
                moguras[num2].visility = false;
            }, 750);

        }, 900);

        let moguraGenerator3 = setInterval(function () {
            let num3 = Math.floor(Math.random() * anaGroup.length);
            anaGroup[num3].src = moguras[num3].abnormalImg;
            moguras[num3].abnormal = true;

            setTimeout(function () {
                anaGroup[num3].src = moguras[num3].kakusuImg;
                moguras[num3].abnormal = false;
            }, 750);

        }, 3000);





        // ゲーム終了時のアクション
        // スタートをクリックしてから20秒後にゲーム終了「スタート」が「おわり」に変わる
        // 25秒後に「もう一度やる」ボタンを表示
        setTimeout(function () {
            let game_end = document.getElementById('game_startend');
            game_end.src = "images/timeout.png";
            game_end.style.backgroundColor = "#895F2C";
            clearInterval(moguraGenerator);
            clearInterval(moguraGenerator2);
            clearInterval(moguraGenerator3);
            document.getElementById('timer').textContent = '0';
            window.alert(`あなたの得点は${score}点でした`)
        }, 20000)

    }

    // もう一度ボタンをクリックしたらリロード
    document.getElementById('again').onclick = function () {
        location.reload();
    }

</script>

</html>


<!-- 修正時刻: Wed 2022/03/23 14:12:41 -->